# SceneBlueprint 缺失功能盘点

> **doc_status**: active  
> **created**: 2026-02-19  
> **last_reviewed**: 2026-02-19  
> **定位**：记录当前系统已有能力的边界，以及大型游戏开发中常见但尚未实现的功能，供后续迭代参考。

---

## 一、当前系统已有能力

| 类别 | 已实现功能 |
|---|---|
| **流程控制** | `Flow.Start` / `Flow.End` / `Flow.Join`（AND） / `Flow.Branch` / `Flow.Filter` / `Flow.Delay` |
| **刷怪** | `Spawn.Preset`（绑定 PointMarker）/ `Spawn.Wave`（绑定 AreaMarker，支持多波次独立配置）|
| **触发器** | `Trigger.EnterArea`（区域进入检测）|
| **视觉效果** | `VFX.CameraShake` / `VFX.ShowWarning`（屏幕文字，支持淡入淡出、三种样式）|
| **场景绑定** | SceneBinding + StableObjectId，支持 PointMarker / AreaMarker 空间数据导出 |
| **运行时系统** | BlueprintRunner + System 架构，Tick 驱动，各节点 System 解耦 |
| **编辑器** | 节点图编辑、子图框、端口容量多连、端口形状视觉区分（三角/菱形/圆形）|
| **导出** | Blueprint JSON V2，支持 Actions / Transitions / SceneBindings / BlackboardInit |

---

## 二、缺失功能盘点

### 2.1 核心逻辑节点（高频缺失，优先级高）

| 节点 | 功能描述 | 典型场景 |
|---|---|---|
| `Condition.DeadCount` | 检测区域内怪物存活数 / 已死亡数是否满足阈值 | 战斗结算：「消灭 X 只后触发 Boss」|
| `Blackboard.Set` | 向黑板写入变量 | 记录当前阶段、触发次数等状态 |
| `Blackboard.Get` + 条件 | 读取黑板变量并作为分支条件 | 根据玩家已完成任务数决定走哪条路径 |
| `Flow.Branch`（随机概率） | 按权重随机走 true / false 分支 | 随机事件、随机奖励触发 |
| `Flow.Loop` | 重复执行某段路径 N 次或无限次 | 周期性刷怪、巡逻循环 |

**备注**：`Blackboard` 框架已存在（`Blackboard.cs`），读写节点尚未实现。设计方案详见 [Blackboard系统设计](Blackboard系统设计.md)（变量声明面板 + Local/Global 分层 + 整型索引 Key）。

---

### 2.2 关卡设计层（策划最高频需求）

| 功能 | 描述 | 备注 |
|---|---|---|
| **多阶段 Phase 系统** | 一张地图内分阶段执行（探索→战斗→Boss），阶段间状态独立，支持阶段重置 | 当前无法在单一蓝图内自然表达阶段切换 |
| **区域锁定/解锁** | `World.LockArea` / `World.UnlockArea`，战斗开始时封锁出口，结束后开门 | 几乎所有动作游戏必备 |
| **目标进度推送** | 向 HUD 推送进度数据（消灭 X/Y 只、收集 X/3 个）| 需要与 UI 系统对接 |
| **NPC 对话 / 剧情触发** | 触发对话框、过场，支持与战斗蓝图协作（先对话→再出怪）| 当前无任何对话节点 |
| **道具生成** | `Spawn.Item`，在指定点生成掉落物/交互道具 | — |

---

### 2.3 怪物行为层（精细控制）

| 功能 | 描述 | 备注 |
|---|---|---|
| **特定怪物死亡检测** | 监听具名怪物（Boss 小弟 A）死亡后触发，而非等全部死亡 | 需要给怪物打 Tag，运行时按 Tag 过滤 |
| **Boss 技能阶段触发** | 血量低于阈值（50% / 25%）时触发特殊增援或技能 | 依赖存活数/血量的条件节点 |
| **动态行为切换** | 运行时改变某只怪物的 AI 行为（Idle → Chase → Flee）| `BehaviorAssign` 已删除，需要通过标注系统替代 |

---

### 2.4 系统能力层（长期稳健性）

| 功能 | 描述 | 优先级 |
|---|---|---|
| **运行时可视化调试** | 蓝图编辑器叠加显示当前执行节点（高亮 Running 状态节点）| 🔴 高——大幅缩短策划调试周期 |
| **存档 / 断点续关** | Blueprint 运行时状态序列化，玩家退出后再进能恢复进度 | 🟡 中——商业项目必须，测试项目可先跳过 |
| **蓝图参数化（外部传参）** | 关卡加载时向蓝图注入参数（难度系数、怪物 ID 列表），实现一份蓝图多处复用 | 🟡 中——依赖 Blackboard 初始化机制 |
| **多蓝图协调** | 多个 BlueprintRunner 并行，彼此间发送事件（如主线蓝图通知支线蓝图）| 🟡 中 |
| **蓝图热重载** | 不重启游戏修改 Blueprint JSON 后立即生效 | 🟢 低——开发期便利性 |

---

## 三、Playbook 方向记录

> 详细讨论见 [Playbook概念与示例.md](Playbook概念与示例.md)

当前 Playbook 文档将其定位为"可读派生文档"（Graph → 文档），价值有限。2026-02-19 讨论中提出两个更有潜力的方向：

### 方向 A：Playbook 作为 AI 辅助建图的中间语言（推荐优先落地）

```
策划用自然语言描述意图
    ↓
AI 生成结构化 Playbook 规则
    ↓
工具自动转换成 NodeGraph
    ↓
策划在图里微调细节
```

**最小落地**：
1. 编辑器新增 Playbook 面板，自动将当前图翻译成结构化规则列表（只读）
2. 支持双向定位：点击规则 → 高亮对应节点
3. 规则格式作为未来 AI 辅助生成蓝图的输入接口

### 方向 B：Playbook 作为可执行脚本（替代简单图）

策划直接写 YAML / DSL，工具解析为运行时格式，跳过图编辑器：

```yaml
on: Start
parallel:
  - spawn.preset: guard_area
  - spawn.wave:
      area: main_arena
      waves: [5 Normal, 5 Elite, 1 Boss]
join: all
then: End
```

**适用场景**：简单线性关卡，不需要复杂分支和汇合。  
**缺点**：需要新的解析器，与 NodeGraph 并行维护两套格式。

---

## 四、推荐的下一步迭代顺序

基于实用价值和实现复杂度综合评估：

| 优先级 | 功能 | 理由 |
|---|---|---|
| **P0** | `Blackboard.Set / Get` 节点 | 所有"有状态"逻辑的基础，解锁后续大量功能 |
| **P0** | `Condition.DeadCount` / 存活数检测 | 战斗结算最核心的缺口，当前无法表达 |
| **P1** | 运行时可视化调试（节点高亮） | 策划调试效率关键，不依赖其他功能 |
| **P1** | 多阶段 Phase 系统 | 关卡设计的核心表达能力 |
| **P2** | Playbook 面板（只读，双向定位）| 沟通协作价值，AI 辅助基础 |
| **P2** | 区域锁定/解锁节点 | 高频关卡需求，实现简单 |
| **P3** | 蓝图参数化（外部传参）| 依赖 Blackboard，中等复杂度 |
| **P3** | 存档 / 断点续关 | 商业级需求，当前阶段可跳过 |

---

## 五、相关文档

- [场景蓝图系统总体设计](场景蓝图系统总体设计.md) — 整体架构与阶段路线
- [SceneBlueprint核心设计原则](SceneBlueprint核心设计原则.md) — 职责边界与设计原则
- [Playbook概念与示例](Playbook概念与示例.md) — Playbook 详细设计
- [节点激活语义与汇聚设计](节点激活语义与汇聚设计.md) — Flow.Join AND 语义
- [标记标注系统设计](标记标注系统设计.md) — SceneMarker 与标注组件
