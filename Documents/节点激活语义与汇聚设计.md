# èŠ‚ç‚¹æ¿€æ´»è¯­ä¹‰ä¸æ±‡èšè®¾è®¡

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1  
> **åˆ›å»ºæ—¥æœŸ**ï¼š2026-02-19  
> **æœ€åæ›´æ–°**ï¼š2026-02-19  
> **çŠ¶æ€**ï¼šâ„ï¸ frozenï¼ˆè®¾è®¡å·²å®šç¨¿å¹¶å®æ–½ï¼‰  
> **é‡è¦æ€§**ï¼šğŸ”´ æ ¸å¿ƒè®¾è®¡ - å½±å“å›¾æ‰§è¡Œè¯­ä¹‰  
> **doc_status**: frozen  
> **last_reviewed**: 2026-02-19

---

## ç›®å½•

- [ä¸€ã€é—®é¢˜èƒŒæ™¯](#ä¸€é—®é¢˜èƒŒæ™¯)
- [äºŒã€èŠ‚ç‚¹è¯­ä¹‰æ¡†æ¶](#äºŒèŠ‚ç‚¹è¯­ä¹‰æ¡†æ¶)
- [ä¸‰ã€ä¸šç•Œæ–¹æ¡ˆå¯¹æ¯”](#ä¸‰ä¸šç•Œæ–¹æ¡ˆå¯¹æ¯”)
- [å››ã€SceneBlueprint çš„è®¾è®¡å†³ç­–](#å››sceneblueprint-çš„è®¾è®¡å†³ç­–)
- [äº”ã€Flow.Join èŠ‚ç‚¹è®¾è®¡](#äº”flowjoin-èŠ‚ç‚¹è®¾è®¡)
- [å…­ã€å®ç°è¦ç‚¹](#å…­å®ç°è¦ç‚¹)
- [ä¸ƒã€ä½¿ç”¨ç¤ºä¾‹](#ä¸ƒä½¿ç”¨ç¤ºä¾‹)
- [å…«ã€æœªæ¥æ‰©å±•](#å…«æœªæ¥æ‰©å±•)

---

## ä¸€ã€é—®é¢˜èƒŒæ™¯

### 1.1 è§¦å‘é—®é¢˜

åœ¨å®ç°æ³¢æ¬¡åˆ·æ€ªåŠŸèƒ½æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªå…³é”®çš„è®¾è®¡é—®é¢˜ï¼š

```
è“å›¾è¿çº¿ï¼š
[Flow.Start] â”€â”€outâ”€â”€â†’ [Spawn.Preset] â”€â”€outâ”€â”€â†’ [Flow.End]
[Flow.Start] â”€â”€outâ”€â”€â†’ [Spawn.Wave]   â”€â”€å®Œæˆâ”€â”€â†’ [Flow.End]
```

**é¢„æœŸè¡Œä¸º**ï¼š
- `Spawn.Preset` ç¬æ—¶å®Œæˆï¼ˆTick 2ï¼‰
- `Spawn.Wave` æŒç»­å¤šä¸ª Tickï¼ˆç¬¬ 1 æ³¢ â†’ ç­‰å¾… â†’ ç¬¬ 2 æ³¢ â†’ ç­‰å¾… â†’ ç¬¬ 3 æ³¢ï¼‰
- å½“ä¸¤è€…éƒ½å®Œæˆåï¼Œ`Flow.End` æ‰æ¿€æ´»

**å®é™…è¡Œä¸º**ï¼š
- `Spawn.Preset` åœ¨ Tick 2 å®Œæˆ â†’ ç«‹å³è§¦å‘ `Flow.End`
- `Flow.End` æ¿€æ´» â†’ è®¾ç½® `frame.IsCompleted = true` â†’ è“å›¾ç»ˆæ­¢
- `Spawn.Wave` åªåˆ·å‡ºç¬¬ 1 æ³¢å°±è¢«å¼ºåˆ¶ç»ˆæ­¢

### 1.2 æ ¹æœ¬åŸå› 

å½“å‰ `TransitionSystem` ä½¿ç”¨ **OR è¯­ä¹‰**ï¼šä»»æ„ä¸€ä¸ªä¸Šæ¸¸çš„ `out` ç«¯å£è§¦å‘ï¼Œå°±ç«‹åˆ»æ¿€æ´»ä¸‹æ¸¸èŠ‚ç‚¹ã€‚

è¿™å¯¹äºå¤§éƒ¨åˆ†åœºæ™¯æ˜¯åˆç†çš„ï¼ˆä¸²è¡Œæ‰§è¡Œã€å•è·¯å¾„åˆ†æ”¯ï¼‰ï¼Œä½†å¯¹äº**å¤šè·¯å¾„æ±‡èš**åœºæ™¯å°±äº§ç”Ÿäº†è¯­ä¹‰å†²çªï¼š

```
é—®é¢˜æœ¬è´¨ï¼š
  Flow.End ä½œä¸ºå¤šè·¯å¾„æ±‡èšç‚¹ï¼Œè¯­ä¹‰ä¸Šåº”è¯¥æ˜¯ ANDï¼ˆç­‰æ‰€æœ‰ä¸Šæ¸¸è·¯å¾„éƒ½å®Œæˆæ‰æ¿€æ´»ï¼‰
  ä½†å½“å‰ TransitionSystem å®ç°çš„æ˜¯ ORï¼ˆä»»æ„ä¸€ä¸ªè§¦å‘å°±æ¿€æ´»ï¼‰
```

---

## äºŒã€èŠ‚ç‚¹è¯­ä¹‰æ¡†æ¶

### 2.1 ä¸‰å±‚è¯­ä¹‰æ¨¡å‹

æ¯ä¸ªèŠ‚ç‚¹éœ€è¦æ˜ç¡®ä¸‰ä¸ªè¯­ä¹‰å±‚ï¼š

| è¯­ä¹‰å±‚ | å«ä¹‰ | ä¾‹å­ |
|---|---|---|
| **æ¿€æ´»è§„åˆ™** | ä» Idle â†’ Running çš„æ¡ä»¶ | OR / AND / è¢«åŠ¨æ£€æµ‹ |
| **æ‰§è¡Œè§„åˆ™** | Running æœŸé—´åšä»€ä¹ˆ | ç¬æ—¶æ‰§è¡Œ / æŒç»­æ‰§è¡Œ / æ— æ“ä½œ |
| **å®Œæˆè§„åˆ™** | ä» Running â†’ Completed çš„æ¡ä»¶ | ç«‹å³å®Œæˆ / æ‰€æœ‰æ³¢æ¬¡åˆ·å®Œ / æ»¡è¶³æŸæ¡ä»¶ |

### 2.2 å½“å‰èŠ‚ç‚¹çš„è¯­ä¹‰åˆ†æ

| èŠ‚ç‚¹ | æ¿€æ´»è§„åˆ™ | æ‰§è¡Œè§„åˆ™ | å®Œæˆè§„åˆ™ |
|---|---|---|---|
| `Flow.Start` | Runner ç›´æ¥è®¾ä¸º Running | æ— æ“ä½œ | ç«‹å³å®Œæˆ |
| `Spawn.Preset` | ORï¼ˆä»»æ„ in è§¦å‘ï¼‰ | ç¬æ—¶æ”¾ç½®æ€ªç‰© | æ”¾å®Œå³å®Œæˆ |
| `Spawn.Wave` | ORï¼ˆä»»æ„ in è§¦å‘ï¼‰ | æŒç»­å¤š Tick | æ‰€æœ‰æ³¢æ¬¡å®Œæˆ |
| `Flow.End` | **?ï¼ˆè¿™æ˜¯äº‰è®®ç‚¹ï¼‰** | æ— æ“ä½œ | ç«‹å³å®Œæˆ + ç»ˆæ­¢è“å›¾ |

---

## ä¸‰ã€ä¸šç•Œæ–¹æ¡ˆå¯¹æ¯”

### 3.1 Unreal Engine Blueprintï¼ˆToken ä¼ é€’æ¨¡å‹ï¼‰

**æ¿€æ´»è§„åˆ™**ï¼šæ¯ä¸ªæ‰§è¡Œå¼•è„šï¼ˆç™½è‰²ï¼‰ä¼ é€’ä¸€ä¸ª"æ‰§è¡Œ Token"ï¼ŒèŠ‚ç‚¹æ”¶åˆ° Token æ‰æ‰§è¡Œã€‚

**æ±‡èšå¤„ç†**ï¼š
- æ™®é€šèŠ‚ç‚¹ï¼šæ”¶åˆ°ä»»æ„ä¸€ä¸ª Token å°±æ‰§è¡Œï¼ˆORï¼‰
- æ²¡æœ‰å†…ç½®çš„ AND æ±‡èšèŠ‚ç‚¹
- ç­–åˆ’éœ€è¦æ˜¾å¼ä½¿ç”¨ **Sequence** èŠ‚ç‚¹ï¼ˆä¸²è¡Œæ‰§è¡Œå¤šä¸ªåˆ†æ”¯ï¼‰æˆ–è‡ªå·±ç”¨å˜é‡è®¡æ•°å®ç° AND

**ä¼˜ç‚¹**ï¼šç®€å•ç›´è§‚ï¼Œæ‰§è¡Œæµæ¸…æ™°å¯è§  
**ç¼ºç‚¹**ï¼šå¤æ‚çš„å¹¶è¡Œæ±‡èšéœ€è¦æ‰‹åŠ¨ç¼–ç¨‹

---

### 3.2 Unity Visual Scriptingï¼ˆFlow è¿æ¥ï¼‰

**æ¿€æ´»è§„åˆ™**ï¼šFlow è¿æ¥ä¼ é€’æ§åˆ¶æµï¼ŒèŠ‚ç‚¹æ”¶åˆ° Flow å°±æ‰§è¡Œã€‚

**æ±‡èšå¤„ç†**ï¼š
- æä¾›æ˜¾å¼çš„ **Flow Merge** èŠ‚ç‚¹ï¼ˆOR è¯­ä¹‰ï¼‰
- æ²¡æœ‰å†…ç½® AND æ±‡èšï¼Œéœ€è¦ç”¨ **Flow Gate** + å˜é‡è®¡æ•°æ‰‹åŠ¨å®ç°

**ä¼˜ç‚¹**ï¼šå’Œ UE ç±»ä¼¼ï¼Œç®€å•ç›´è§‚  
**ç¼ºç‚¹**ï¼šåŒæ ·éœ€è¦æ‰‹åŠ¨å¤„ç† AND

---

### 3.3 Houdiniï¼ˆæ•°æ®æµ + ä¾èµ–å›¾ï¼‰

**æ¿€æ´»è§„åˆ™**ï¼šèŠ‚ç‚¹ä¸ä¸»åŠ¨"æ¿€æ´»"ï¼Œè€Œæ˜¯è¢«ä¸‹æ¸¸**æ‹‰å–**ï¼ˆPullï¼‰ã€‚å½“æŸèŠ‚ç‚¹éœ€è¦æ•°æ®æ—¶ï¼Œé€’å½’æ‹‰å–æ‰€æœ‰ä¸Šæ¸¸ä¾èµ–ã€‚

**æ±‡èšå¤„ç†**ï¼š
- å¤©ç„¶æ”¯æŒ ANDâ€”â€”ä¸‹æ¸¸èŠ‚ç‚¹è¿æ¥å¤šä¸ªä¸Šæ¸¸æ—¶ï¼Œä¼šç­‰æ‰€æœ‰ä¸Šæ¸¸è®¡ç®—å®Œæ¯•
- ç”¨ **Merge** èŠ‚ç‚¹åˆå¹¶å¤šä¸ªå‡ ä½•ä½“æµ

**ä¼˜ç‚¹**ï¼šæ•°æ®æµæ¨¡å‹å¤©ç„¶æ”¯æŒå¤æ‚ä¾èµ–ï¼Œæ— éœ€æ˜¾å¼æ±‡èšé€»è¾‘  
**ç¼ºç‚¹**ï¼šä¸é€‚åˆæœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼ˆå¦‚åˆ·æ€ªï¼‰ï¼Œéœ€è¦é¢å¤–çš„æ‰§è¡Œé¡ºåºæ§åˆ¶

---

### 3.4 Behavior Treeï¼ˆæ¸¸æˆ AI å¸¸ç”¨ï¼‰

**æ¿€æ´»è§„åˆ™**ï¼šæ ‘å½¢ç»“æ„ï¼Œçˆ¶èŠ‚ç‚¹æ§åˆ¶å­èŠ‚ç‚¹çš„æ‰§è¡Œç­–ç•¥ã€‚

**æ±‡èšå¤„ç†**ï¼š
- **Sequence èŠ‚ç‚¹**ï¼šAND è¯­ä¹‰ï¼Œæ‰€æœ‰å­èŠ‚ç‚¹æˆåŠŸæ‰æˆåŠŸ
- **Selector èŠ‚ç‚¹**ï¼šOR è¯­ä¹‰ï¼Œä»»æ„å­èŠ‚ç‚¹æˆåŠŸå°±æˆåŠŸ
- **Parallel èŠ‚ç‚¹**ï¼šå¹¶è¡Œæ‰§è¡Œå¤šä¸ªå­èŠ‚ç‚¹ï¼Œå¯é…ç½®æˆåŠŸæ¡ä»¶ï¼ˆå…¨éƒ¨/ä»»æ„/Nä¸ªï¼‰

**ä¼˜ç‚¹**ï¼šè¯­ä¹‰æ¸…æ™°ï¼Œå¤©ç„¶æ”¯æŒ AND/OR/N-of-M  
**ç¼ºç‚¹**ï¼šåªèƒ½æ˜¯æ ‘ï¼Œä¸èƒ½æ˜¯ä»»æ„å›¾ï¼ˆDAGï¼‰

---

### 3.5 Petri Netï¼ˆå­¦æœ¯æ¨¡å‹ï¼Œå·¥ä½œæµå¼•æ“å¸¸ç”¨ï¼‰

**æ¿€æ´»è§„åˆ™**ï¼šèŠ‚ç‚¹ï¼ˆTransitionï¼‰æœ‰å¤šä¸ªè¾“å…¥ Placeï¼Œæ¯ä¸ª Place éœ€è¦æœ‰ Token æ‰èƒ½è§¦å‘ã€‚

**æ±‡èšå¤„ç†**ï¼š
- å¤©ç„¶ ANDâ€”â€”Transition ç­‰æ‰€æœ‰è¾“å…¥ Place éƒ½æœ‰ Token æ‰è§¦å‘
- ç”¨ Place çš„ Token æ•°é‡è¡¨è¾¾å¹¶å‘çŠ¶æ€

**ä¼˜ç‚¹**ï¼šç†è®ºå®Œå¤‡ï¼Œæ”¯æŒä»»æ„å¤æ‚çš„å¹¶å‘/åŒæ­¥æ¨¡å¼  
**ç¼ºç‚¹**ï¼šå¯¹ç­–åˆ’æ¥è¯´å¤ªæŠ½è±¡ï¼Œå­¦ä¹ æˆæœ¬é«˜

---

## å››ã€SceneBlueprint çš„è®¾è®¡å†³ç­–

### 4.1 æ ¸å¿ƒè®¾è®¡ï¼šèŠ‚ç‚¹ç±»å‹åˆ†å±‚

åŸºäºä¸šç•Œæ–¹æ¡ˆåˆ†æï¼Œæˆ‘ä»¬é‡‡ç”¨**æ··åˆæ¨¡å‹**ï¼š

| èŠ‚ç‚¹ç±»å‹ | æ¿€æ´»è§„åˆ™ | å…¸å‹èŠ‚ç‚¹ |
|---|---|---|
| **Flow æ§åˆ¶èŠ‚ç‚¹** | ç‰¹æ®Šè¯­ä¹‰ | `Flow.Start`, `Flow.End`, `Flow.Join`, `Flow.Branch`, `Flow.Filter`, `Flow.Delay` |
| **Action æ‰§è¡ŒèŠ‚ç‚¹** | ORï¼ˆä»»æ„ in è§¦å‘ï¼‰ | `Spawn.Preset`, `Spawn.Wave`, `Trigger.EnterArea`, `VFX.CameraShake`, `VFX.ShowWarning` |

### 4.2 è®¾è®¡åŸåˆ™

**åŸåˆ™ 1ï¼šèŒè´£åˆ†ç¦»**
- `Flow.Join` è´Ÿè´£ AND æ±‡èš
- `Flow.End` åªè´Ÿè´£ç»ˆæ­¢è“å›¾
- æ™®é€š Action èŠ‚ç‚¹ä¿æŒç®€å•çš„ OR è¯­ä¹‰

**åŸåˆ™ 2ï¼šæ˜¾å¼ä¼˜äºéšå¼**
- ç­–åˆ’çœ‹åˆ° `Flow.Join` å°±çŸ¥é“"è¿™é‡Œåœ¨ç­‰å¤šä¸ªè·¯å¾„"
- é¿å…éšå¼çš„"æ™ºèƒ½åˆ¤æ–­"å¯¼è‡´çš„ä¸å¯é¢„æµ‹è¡Œä¸º

**åŸåˆ™ 3ï¼šæ‰©å±•æ€§å¥½**
- æœªæ¥å¯ä»¥åŠ  `Flow.Join(N-of-M)` å˜ä½“
- æˆ– `Flow.Race`ï¼ˆä»»æ„ä¸€ä¸ªå®Œæˆå°±è§¦å‘ï¼‰

**åŸåˆ™ 4ï¼šå¯¹é½ä¸šç•Œ**
- UE/Unity VS éƒ½æ˜¯è¿™ä¸ªæ€è·¯â€”â€”åŸºç¡€èŠ‚ç‚¹ ORï¼Œæ˜¾å¼æ±‡èšèŠ‚ç‚¹ AND
- é™ä½å­¦ä¹ æˆæœ¬

---

## äº”ã€Flow.Join èŠ‚ç‚¹è®¾è®¡

### 5.1 èŠ‚ç‚¹å®šä¹‰

```csharp
[ActionType("Flow.Join")]
public class FlowJoinDef : IActionDefinitionProvider
{
    public ActionDefinition GetDefinition()
    {
        return ActionDefinition.Create("Flow.Join", "æ±‡åˆ")
            .Category("Flow")
            .Description("ç­‰å¾…æ‰€æœ‰è¿å…¥çš„è¾“å…¥éƒ½å®Œæˆï¼ˆAND Joinï¼‰")
            .Port(Port.InMulti("in", "è¾“å…¥"))  // Multiple Inputï¼Œå…è®¸è¿å¤šæ¡çº¿
            .Port(Port.Out("out", "è¾“å‡º"))      // Multiple Output
            .Build();
    }
}
```

### 5.2 æ¿€æ´»è¯­ä¹‰

**æ¿€æ´»è§„åˆ™**ï¼šANDâ€”â€”ç»Ÿè®¡å…¥è¾¹æ•°é‡ Nï¼Œæ”¶åˆ° N ä¸ª PortEvent åæ‰æ¿€æ´»

```
çŠ¶æ€æµï¼š
Idle â†’ WaitingTrigger(1/N) â†’ WaitingTrigger(2/N) â†’ ... â†’ WaitingTrigger(N/N) â†’ Running â†’ Completed
```

**å…³é”®è®¾è®¡**ï¼š
- ä½¿ç”¨ `ActionRuntimeState.CustomInt` è®°å½•å·²æ”¶åˆ°çš„ PortEvent æ•°é‡
- å…¥è¾¹è®¡æ•°åœ¨å¯¼å‡ºæ—¶ç¡®å®šï¼Œå†™å…¥ `ActionData.Properties["inEdgeCount"]`
- TransitionSystem æ£€æµ‹åˆ°ç›®æ ‡èŠ‚ç‚¹æ˜¯ `Flow.Join` æ—¶ï¼Œç´¯åŠ è®¡æ•°è€Œéç›´æ¥æ¿€æ´»

### 5.3 æ‰§è¡Œè§„åˆ™

**æ‰§è¡Œè§„åˆ™**ï¼šç¬æ—¶ï¼ˆæ— æ“ä½œï¼‰

å½“æ”¶é½æ‰€æœ‰è¾“å…¥åï¼š
1. ä» `WaitingTrigger` è¿›å…¥ `Running`
2. ç«‹å³è¿›å…¥ `Completed`
3. è§¦å‘ `out` ç«¯å£

### 5.4 å®Œæˆè§„åˆ™

**å®Œæˆè§„åˆ™**ï¼šç«‹å³å®Œæˆï¼Œè§¦å‘ `out` ç«¯å£

---

## å…­ã€å®ç°è¦ç‚¹

### 6.1 å¯¼å‡ºæ—¶è®¡ç®—å…¥è¾¹æ•°

```csharp
// BlueprintExporter.cs
public class BlueprintExporter
{
    private void EnrichActionWithInEdgeCount(ActionEntry action, Graph graph)
    {
        if (action.TypeId != "Flow.Join")
            return;
        
        // ç»Ÿè®¡è¿åˆ°è¯¥èŠ‚ç‚¹ "in" ç«¯å£çš„å…¥è¾¹æ•°é‡
        var node = graph.Nodes.First(n => n.Id == action.Id);
        var inPort = node.Ports.First(p => p.Id == "in");
        int inEdgeCount = graph.Edges.Count(e => e.ToNodeId == node.Id && e.ToPortId == inPort.Id);
        
        // å†™å…¥å±æ€§
        action.Properties = action.Properties.Append(new PropertyValue
        {
            Key = "inEdgeCount",
            ValueType = "int",
            Value = inEdgeCount.ToString()
        }).ToArray();
    }
}
```

### 6.2 TransitionSystem ç‰¹æ®Šå¤„ç†

```csharp
// TransitionSystem.cs
public class TransitionSystem : BlueprintSystemBase
{
    public override void Update(BlueprintFrame frame)
    {
        foreach (var evt in frame.PortEvents)
        {
            var targetAction = frame.Actions[evt.TargetActionIndex];
            
            if (targetAction.TypeId == "Flow.Join")
            {
                // Flow.Join ç‰¹æ®Šå¤„ç†ï¼šç´¯åŠ è®¡æ•°
                ref var state = ref frame.States[evt.TargetActionIndex];
                state.CustomInt++; // å·²æ”¶åˆ°çš„è¾“å…¥æ•°é‡
                
                int requiredCount = int.Parse(targetAction.Properties.First(p => p.Key == "inEdgeCount").Value);
                
                if (state.CustomInt >= requiredCount)
                {
                    // æ”¶é½æ‰€æœ‰è¾“å…¥ï¼Œæ¿€æ´»èŠ‚ç‚¹
                    state.Phase = ActionPhase.Running;
                }
                else
                {
                    // è¿˜æ²¡æ”¶é½ï¼Œä¿æŒ WaitingTrigger
                    state.Phase = ActionPhase.WaitingTrigger;
                }
            }
            else
            {
                // æ™®é€šèŠ‚ç‚¹ï¼šOR è¯­ä¹‰ï¼Œç›´æ¥æ¿€æ´»
                ref var state = ref frame.States[evt.TargetActionIndex];
                state.Phase = ActionPhase.Running;
            }
        }
    }
}
```

### 6.3 FlowSystem å¤„ç† Flow.Join

```csharp
// FlowSystem.cs
public class FlowSystem : BlueprintSystemBase
{
    public override void Update(BlueprintFrame frame)
    {
        for (int i = 0; i < frame.Actions.Length; i++)
        {
            var action = frame.Actions[i];
            ref var state = ref frame.States[i];
            
            if (action.TypeId == "Flow.Join" && state.Phase == ActionPhase.Running)
            {
                // Flow.Join ç¬æ—¶å®Œæˆ
                state.Phase = ActionPhase.Completed;
                
                // è§¦å‘ out ç«¯å£
                frame.PortEvents.Add(new PortEvent
                {
                    SourceActionIndex = i,
                    SourcePortId = "out",
                    TargetActionIndex = FindTargetAction(frame, i, "out"),
                    TargetPortId = "in"
                });
            }
        }
    }
}
```

---

## ä¸ƒã€ä½¿ç”¨ç¤ºä¾‹

### 7.1 åŸºç¡€å¹¶è¡Œæ±‡èš

```
[Flow.Start] â”€â”€â†’ [Spawn.Preset] â”€â”€â”
                                   â”œâ”€â”€â†’ [Flow.Join] â”€â”€â†’ [Flow.End]
[Flow.Start] â”€â”€â†’ [Spawn.Wave]   â”€â”€â”˜
```

**æ‰§è¡Œæµç¨‹**ï¼š
- Tick 1: `Flow.Start` â†’ Completed â†’ æ¿€æ´» `Spawn.Preset` å’Œ `Spawn.Wave`
- Tick 2: `Spawn.Preset` â†’ Completed â†’ `Flow.Join` æ”¶åˆ° 1/2 è¾“å…¥ â†’ ä¿æŒ WaitingTrigger
- Tick 2-60: `Spawn.Wave` æŒç»­æ‰§è¡Œï¼ˆç¬¬ 1 æ³¢ï¼‰
- Tick 61: `Spawn.Wave` ç¬¬ 1 æ³¢å®Œæˆï¼Œç»§ç»­æ‰§è¡Œ
- ...
- Tick 122: `Spawn.Wave` ç¬¬ 3 æ³¢å®Œæˆ â†’ Completed â†’ `Flow.Join` æ”¶åˆ° 2/2 è¾“å…¥ â†’ Running â†’ Completed â†’ æ¿€æ´» `Flow.End`
- Tick 123: `Flow.End` â†’ Completed â†’ è“å›¾ç»ˆæ­¢

### 7.2 å¤šè·¯å¾„æ±‡èš

```
[Flow.Start] â”€â”€â†’ [Spawn.Wave1] â”€â”€â”
                                  â”‚
[Flow.Start] â”€â”€â†’ [Spawn.Wave2] â”€â”€â”¼â”€â”€â†’ [Flow.Join] â”€â”€â†’ [Boss.Spawn]
                                  â”‚
[Flow.Start] â”€â”€â†’ [Spawn.Wave3] â”€â”€â”˜
```

**è¯­ä¹‰**ï¼šä¸‰æ³¢æ€ªç‰©å¹¶è¡Œåˆ·æ–°ï¼Œå…¨éƒ¨å®Œæˆåæ‰åˆ· Boss

### 7.3 æ¡ä»¶åˆ†æ”¯ + æ±‡èš

```
[Flow.Start] â”€â”€â†’ [Flow.Branch] â”€â”€Trueâ”€â”€â†’ [Spawn.Elite] â”€â”€â”
                      â”‚                                    â”œâ”€â”€â†’ [Flow.Join] â”€â”€â†’ [Flow.End]
                      â””â”€â”€Falseâ”€â”€â†’ [Spawn.Normal] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯­ä¹‰**ï¼šæ ¹æ®æ¡ä»¶é€‰æ‹©åˆ·ç²¾è‹±æˆ–æ™®é€šæ€ªï¼Œæ— è®ºèµ°å“ªæ¡è·¯å¾„ï¼Œæœ€ç»ˆéƒ½æ±‡èšåˆ° `Flow.Join`

**æ³¨æ„**ï¼šè¿™ç§æƒ…å†µä¸‹ï¼Œ`Flow.Join` çš„ `inEdgeCount` ä»ç„¶æ˜¯ 2ï¼Œä½†å®é™…åªä¼šæ”¶åˆ° 1 ä¸ªè¾“å…¥ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ–¹æ¡ˆ Aï¼šç­–åˆ’æ‰‹åŠ¨ç¡®ä¿åˆ†æ”¯è·¯å¾„æœ€ç»ˆéƒ½ä¼šæ‰§è¡Œï¼ˆä¸æ¨èï¼Œå®¹æ˜“å‡ºé”™ï¼‰
- æ–¹æ¡ˆ Bï¼šå¼•å…¥"æ­»è·¯å¾„æ¶ˆé™¤"æœºåˆ¶ï¼ˆæœªæ¥æ‰©å±•ï¼‰
- æ–¹æ¡ˆ Cï¼šä½¿ç”¨ `Flow.Merge`ï¼ˆOR è¯­ä¹‰ï¼‰è€Œé `Flow.Join`ï¼ˆAND è¯­ä¹‰ï¼‰

---

## å…«ã€æœªæ¥æ‰©å±•

### 8.1 Flow.Join å˜ä½“

**Flow.Join(N-of-M)**ï¼šN ä¸ªè¾“å…¥ä¸­ä»»æ„ M ä¸ªå®Œæˆå³å¯

```csharp
[ActionType("Flow.JoinAny")]
public class FlowJoinAnyDef : IActionDefinitionProvider
{
    public ActionDefinition GetDefinition()
    {
        return ActionDefinition.Create("Flow.JoinAny", "æ±‡åˆï¼ˆä»»æ„ï¼‰")
            .Category("Flow")
            .Description("ç­‰å¾… N ä¸ªä¸Šæ¸¸è·¯å¾„ä¸­ä»»æ„ M ä¸ªå®Œæˆåç»§ç»­")
            .Duration()
            .Port(Prop.EventIn("in", "è¾“å…¥", multiple: true))
            .Port(Prop.EventOut("out", "è¾“å‡º"))
            .Prop(Prop.Int("requiredCount", "éœ€è¦å®Œæˆæ•°", defaultValue: 1, min: 1))
            .Build();
    }
}
```

### 8.2 Flow.Race

**Flow.Race**ï¼šä»»æ„ä¸€ä¸ªè¾“å…¥å®Œæˆå°±è§¦å‘ï¼Œå…¶ä»–è·¯å¾„è¢«å–æ¶ˆ

```csharp
[ActionType("Flow.Race")]
public class FlowRaceDef : IActionDefinitionProvider
{
    public ActionDefinition GetDefinition()
    {
        return ActionDefinition.Create("Flow.Race", "ç«é€Ÿ")
            .Category("Flow")
            .Description("ä»»æ„ä¸€ä¸ªä¸Šæ¸¸è·¯å¾„å®Œæˆå°±ç»§ç»­ï¼Œå…¶ä»–è·¯å¾„è¢«å–æ¶ˆ")
            .Duration()
            .Port(Prop.EventIn("in", "è¾“å…¥", multiple: true))
            .Port(Prop.EventOut("out", "è¾“å‡º"))
            .Port(Prop.EventOut("cancelled", "å·²å–æ¶ˆ"))
            .Build();
    }
}
```

### 8.3 æ­»è·¯å¾„æ¶ˆé™¤

**é—®é¢˜**ï¼šæ¡ä»¶åˆ†æ”¯åœºæ™¯ä¸‹ï¼Œæœªèµ°åˆ°çš„è·¯å¾„æ°¸è¿œä¸ä¼šè§¦å‘ `Flow.Join`ï¼Œå¯¼è‡´æ­»é”ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨å¯¼å‡ºæ—¶åˆ†æå›¾çš„å¯è¾¾æ€§
2. æ ‡è®°"å¯èƒ½ä¸æ‰§è¡Œ"çš„è·¯å¾„
3. è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´ `Flow.Join` çš„ `requiredCount`

**å®ç°å¤æ‚åº¦**ï¼šé«˜ï¼ˆéœ€è¦é™æ€åˆ†æ + åŠ¨æ€è°ƒæ•´ï¼‰

**ä¼˜å…ˆçº§**ï¼šä½ï¼ˆå½“å‰å¯ä»¥é€šè¿‡ä½¿ç”¨ `Flow.Merge` è§„é¿ï¼‰

---

## é™„å½•

### æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|-----|------|
| **æ¿€æ´»è§„åˆ™** | èŠ‚ç‚¹ä» Idle è¿›å…¥ Running çš„æ¡ä»¶ |
| **OR è¯­ä¹‰** | ä»»æ„ä¸€ä¸ªè¾“å…¥è§¦å‘å°±æ¿€æ´» |
| **AND è¯­ä¹‰** | æ‰€æœ‰è¾“å…¥éƒ½è§¦å‘æ‰æ¿€æ´» |
| **æ±‡èšèŠ‚ç‚¹** | ç­‰å¾…å¤šä¸ªä¸Šæ¸¸è·¯å¾„å®Œæˆçš„èŠ‚ç‚¹ |
| **å…¥è¾¹è®¡æ•°** | è¿æ¥åˆ°èŠ‚ç‚¹è¾“å…¥ç«¯å£çš„è¾¹æ•°é‡ |
| **æ­»è·¯å¾„** | ç”±äºæ¡ä»¶åˆ†æ”¯å¯¼è‡´æ°¸è¿œä¸ä¼šæ‰§è¡Œçš„è·¯å¾„ |

---

### è®¾è®¡å†³ç­–è®°å½•

| å†³ç­– | ç†ç”± | å½±å“ |
|-----|------|------|
| å¼•å…¥ Flow.Join èŠ‚ç‚¹ | æ˜¾å¼è¡¨è¾¾ AND æ±‡èšè¯­ä¹‰ï¼Œé¿å…éšå¼åˆ¤æ–­ | ç­–åˆ’éœ€è¦æ‰‹åŠ¨æ·»åŠ  Flow.Join |
| Flow.Join ä½¿ç”¨ CustomInt è®¡æ•° | å¤ç”¨å·²æœ‰çŠ¶æ€å­—æ®µï¼Œæ— éœ€æ‰©å±•æ•°æ®ç»“æ„ | é™åˆ¶äº† CustomInt çš„å…¶ä»–ç”¨é€” |
| å…¥è¾¹è®¡æ•°åœ¨å¯¼å‡ºæ—¶ç¡®å®š | é¿å…è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—ï¼Œæå‡æ€§èƒ½ | å›¾ç»“æ„å˜åŒ–éœ€è¦é‡æ–°å¯¼å‡º |
| æš‚ä¸å®ç°æ­»è·¯å¾„æ¶ˆé™¤ | å®ç°å¤æ‚åº¦é«˜ï¼Œå½“å‰å¯ç”¨ Flow.Merge è§„é¿ | æ¡ä»¶åˆ†æ”¯ + Flow.Join éœ€è¦ç­–åˆ’æ³¨æ„ |

---

### ç›¸å…³æ–‡æ¡£

- [åœºæ™¯è“å›¾ç³»ç»Ÿæ€»ä½“è®¾è®¡](åœºæ™¯è“å›¾ç³»ç»Ÿæ€»ä½“è®¾è®¡.md) - ç³»ç»Ÿæ•´ä½“æ¶æ„
- [SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™](SceneBlueprintæ ¸å¿ƒè®¾è®¡åŸåˆ™.md) - è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µ
- [æ•°æ®å¯¼å‡ºä¸è¿è¡Œæ—¶å¥‘çº¦](æ•°æ®å¯¼å‡ºä¸è¿è¡Œæ—¶å¥‘çº¦.md) - å¯¼å‡ºæ•°æ®æ ¼å¼

---

**ç‰ˆæœ¬å†å²**ï¼š

- **v1.0** (2026-02-19)
  - åˆå§‹ç‰ˆæœ¬
  - å®šä¹‰èŠ‚ç‚¹æ¿€æ´»è¯­ä¹‰æ¡†æ¶ï¼ˆæ¿€æ´»è§„åˆ™ / æ‰§è¡Œè§„åˆ™ / å®Œæˆè§„åˆ™ï¼‰
  - å¯¹æ¯”ä¸šç•Œæ–¹æ¡ˆï¼ˆUE / Unity VS / Houdini / Behavior Tree / Petri Netï¼‰
  - ç¡®å®š SceneBlueprint çš„æ··åˆæ¨¡å‹è®¾è®¡
  - è¯¦ç»†è®¾è®¡ Flow.Join èŠ‚ç‚¹ï¼ˆAND æ±‡èšè¯­ä¹‰ï¼‰
  - æè¿°å®ç°è¦ç‚¹ï¼ˆå¯¼å‡ºæ—¶è®¡ç®—å…¥è¾¹æ•° / TransitionSystem ç‰¹æ®Šå¤„ç†ï¼‰
  - æä¾›ä½¿ç”¨ç¤ºä¾‹å’Œæœªæ¥æ‰©å±•æ–¹å‘
